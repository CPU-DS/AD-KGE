# 知识表示学习模型的对比分析

## DRKG 知识图谱的数据集的划分

划分数据集: [01_split_dataset.ipynb](01_split_dataset.ipynb)

## 各个模型的训练结果

### TransE_l1

训练脚本: [02_Train_TransE_l1.ipynb](02_Train_TransE_l1.ipynb)

TransE_l1 模型的网格搜索**验证集**结果, 加粗的是最优结果, MR 越低越好, MRR 和 Hits@k 越高越好.

|参数编号|[0]MRR|[0]MR|[0]HITS@1|[0]HITS@3|[0]HITS@10|[1]MRR|[1]MR|[1]HITS@1|[1]HITS@3|[1]HITS@10|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|1|0.48122696036532836|76.20820055019884|0.36836765266655774|0.5478802364220733|0.6833258430026693|0.48289008172554343|74.24485383740645|0.37130678142683016|0.5483463505314694|0.6831815984256794|
|2|0.48267444788162295|71.13128417440095|0.36739140796829567|0.5515569567674676|0.6884520315681241|0.48096923309855205|72.86914392329902|0.36501062265075995|0.551182791305769|0.6870369613771313|
|3|0.47400738903192896|72.81550634635289|0.359348613607888|0.5415645257939751|0.6806769897042|0.4749349027381162|71.40871051430985|0.3605173740441382|0.5417719277937041|0.6810230360146264|
|4|0.5014444223687231|70.2040590506411|0.38596389685203975|0.5716751669991897|0.7074398905057301|0.4999264299303186|72.35809228087378|0.3838692324453887|0.5706304134662527|0.7062837064879882|
|5|0.5120793746352214|63.73809556234977|0.393678884901639|0.5855662310955555|0.7233294974022348|0.5121924790037987|65.47711703982132|0.3939913929291278|0.5857098109712916|0.7226466742931852|
|6|0.50933856403605|63.334324099798444|0.3905730783897151|0.5840278912676363|0.721141798768862|0.5097445143374414|62.208682595994745|0.3909415281532375|0.5834349060650837|0.7216680171867872|
|7|0.49119904221329336|74.14914508671701|0.375303867027108|0.5607836194393185|0.6986251932151685|0.4905121523890639|75.50917905975922|0.3750749033066405|0.5598545513972871|0.6968390804597702|
|8|0.5130088873645207|64.62505021892045|0.39454367173508925|0.587248139346439|0.7241908795631125|0.5118707047974405|66.35279457427684|0.3934466416081059|0.5861830636814295|0.7227692433404151|
|9|0.509035085275767|61.944459576322544|0.3891540750526022|0.5840000817121418|0.7242487589968473|0.507942494897664|63.83500163425396|0.38797189083183525|0.5830745764558479|0.7229190499536962|
|10|0.4952289118431002|72.78330473388898|0.38342662199705835|0.562438715476385|0.693189246608923|0.4960628596106997|70.92829078627508|0.3839551400341829|0.5629455865229441|0.6950162402881714|
|11|0.4857781925826427|71.27453577289472|0.3735334372893359|0.5521391557773889|0.6859189551740809|0.484052056738569|73.14981001797679|0.37175532494416297|0.5506414446805034|0.6845379146919431|
|12|0.4531364398013237|75.21384407961486|0.3366199772567872|0.5197641242841676|0.6654534683399498|0.451064186312205|77.35509274391241|0.3349097074685406|0.5172209511358065|0.6634900855259575|
|13|**`0.5330231677081421`**|63.89646050239349|**`0.41905050491294255`**|0.6050920282996384|0.7329681254553749|**`0.5316331356014069`**|65.63173108351037|**`0.4170241597210873`**|0.6045445878956256|0.7324079370267473|
|14|0.5255667998225652|62.922151631530205|0.4068611428882715|0.6016403824154274|0.7349716729313068|0.5262901176734012|61.68584405237748|0.4081930040787977|0.6013502931423085|0.7356407934248963|
|15|0.5037199338747503|62.75795336928692|0.381656180203737|0.5797549980933704|0.722231301410906|0.5054789886326427|61.4538224258973|0.38422070449484874|0.5806158371749389|0.7240002178990447|
|16|0.5283970961559467|65.72206976855036|0.4122275410773746|0.6008702343095664|0.7349019794766337|0.5268956976889748|67.38687217410252|0.4102113635125565|0.6000980552377839|0.734181783515825|
|17|0.5321311507641732|**`61.461346752282836`**|0.41401839885058256|**`0.6073459215427253`**|**`0.7421539320563542`**|0.5306987907911145|62.68348586370322|0.4119784006101215|**`0.6069414937081222`**|**`0.7413554774745329`**|
|18|0.511921663585674|61.573572070599774|0.38970828566759275|0.5888693686332189|0.7317133790924443|0.5130283538431702|**`60.0321911791743`**|0.39094833749838276|0.5895565073506881|0.7339963365723119|

TransE_l1 模型最佳参数是第 17 号: 

- batch_size: **4096**

- neg_sample_size: **256**

- hidden_dim: 200, **400**

- gamma: 6, 12, **18**

- lr: 0.01, **0.05**, 0.1

对应的测试集结果:

- Test average MRR : 0.5299729313494324

- Test average MR : 62.644429615203904

- Test average HITS@1 : 0.41152788086369735

- Test average HITS@3 : 0.6055363380703678

- Test average HITS@10 : 0.7400889981410488

### TransE_l2

训练脚本: [03_Train_TransE_l2.ipynb](03_Train_TransE_l2.ipynb)

TransE_l2 模型的网格搜索验证集结果, 加粗的是最优结果, MR 越低越好, MRR 和 Hits@k 越高越好.

|参数编号|[0]MRR|[0]MR|[0]HITS@1|[0]HITS@3|[0]HITS@10|[1]MRR|[1]MR|[1]HITS@1|[1]HITS@3|[1]HITS@10|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|1|0.3382910173602461|124.41254358010568|0.2450257394999183|0.37389687857493054|0.5165263932015035|0.33983934897084694|122.23542289438025|0.24678088208257012|0.3748884969732461|0.5172787133061414|
|2|0.42796099959437905|73.70411831998693|0.3085675764013728|0.49333020101323743|0.6526563436291333|0.42917269431302585|72.27962575839082|0.3095392116140191|0.49522664905316055|0.65324771716704|
|3|0.430608388334019|70.76222966715694|0.30926553903143217|0.4976677834068748|0.658447731110748|0.43204861476570494|69.52074807465766|0.3109487460590915|0.4996901747958899|0.6588654269118939|
|4|0.22731269206151322|190.36415944871166|0.14723266328920848|0.25056858419131667|0.3760077899438906|0.22779628337957006|188.3008811292618|0.14782747843139926|0.2502196013809352|0.3766112612950013|
|5|0.4069249131270877|73.55388234813458|0.2813621414028613|0.4720408288334911|0.6497681417978033|0.4059100089363876|73.85231791687094|0.28049245519420385|0.4706889742332625|0.6490609849103884|
|6|0.419027714882311|66.23961064164459|0.28483831209952537|0.4930408492615265|0.6776490054951415|0.41837934375893626|67.14377008770497|0.2844521163588822|0.49201939314702836|0.6771258920302882|
|7|0.1802571911784871|238.4513571117285|0.11158890341559079|0.1957768153837773|0.3044342757531187|0.1817561502550769|236.07416738732235|0.11302491539388657|0.19735184567300162|0.3056885269343647|
|8|0.35821379801699993|92.08655699081419|0.24082610975302504|0.40711031820069865|0.5956304432202755|0.35728452583197523|94.07067467451108|0.23968377185814677|0.4067555973198235|0.5945484011548728|
|9|0.36241274851052147|84.07679972217683|0.23175083074576455|0.4196423707577491|0.6322383831780792|0.3629433550328978|82.15939315116066|0.23302600488910982|0.41922073854157443|0.6330069387227031|
|10|0.37350078020018523|101.97766860053386|0.2744320967478346|0.41502560331208804|0.5635997167293131|0.3743371509976858|100.53971891023241|0.2751758513383768|0.41563902299515854|0.5644742845080588|
|11|0.4360053122241365|69.44146686913119|**`0.3160114941746052`**|0.5026794773146667|0.6598017118693695|0.4348720794271351|70.76965871329737|**`0.31477774146102305`**|0.5019236531023588|0.659292095658332|
|12|0.4340395155559925|70.13165277550799|0.31262256904722996|0.5022539085907284|0.6604939532603367|0.4352961100840235|68.86682963699381|0.31420361303853406|0.5024547689248725|0.6614870247928257|
|13|0.2785167394881829|156.24436522852318|0.19065274827041456|0.3069128942637686|0.4446328376096312|0.27957138229044726|153.88232430187188|0.19170349387499405|0.30751343143329907|0.4458180406790279|
|14|0.43153780042703227|64.09098028000219|0.29941915890396037|0.5064859454159176|0.6819197036552813|0.43203328532534274|63.40704222474925|0.29961799573734993|0.5076332759078559|0.6828513451861334|
|15|**`0.43720292675679395`**|**`60.55879569101705`**|0.30186373045704634|**`0.5154028436018957`**|**`0.6927125892030288`**|**`0.43882771726763714`**|**`59.55881571869234`**|0.30384659907256717|**`0.5163696657292468`**|**`0.6943659478267975`**|
|16|0.21547286845364044|205.91741910442883|0.1372500953314812|0.23613948357574768|0.36113948357574766|0.21656561726517387|203.94086083741325|0.13807649618336204|0.23796278011943592|0.3623593019059357|
|17|0.39067502956758654|75.11485060195021|0.2609426921610285|0.4543770768644114|0.6487205153347497|0.3916976274407525|73.9917130269582|0.26221766752691394|0.45485063701423833|0.650299270719135|
|18|0.3962854144830095|70.73069537506129|0.25975445334204933|0.46458095004630384|0.6706297325271013|0.3971110873826839|69.95326405959538|0.2601646499656128|0.4664775938497995|0.6711188435008205|

TransE_l2 模型最佳参数是第 15 号: 

- batch_size: **4096**

- neg_sample_size: **256**

- hidden_dim: 200, **400**

- gamma: 6, **12**, 18

- lr: 0.01, 0.05, **0.1**

对应的测试集结果:

- Test average MRR : 0.43722459698865124

- Test average MR : 60.83355236726884

- Test average HITS@1 : 0.3020931926976583

- Test average HITS@3 : 0.5153057055502972

- Test average HITS@10 : 0.6925784947261622

### TransR

训练脚本: [04_Train_TransR.ipynb](04_Train_TransR.ipynb)

使用两个 GPU 训练模型. 训练一次大约 100000 * 2.7 / 3600 = 75.0 h, 因此我们没有进行 TransR 的网格搜索实验, 也不会进行 TransR 的药物重定位实验.

### RESCAL

训练脚本: [05_Train_RESCAL.ipynb](05_Train_RESCAL.ipynb)

使用两个 GPU 训练模型. 训练一次大约 100000 * 1.35 / 3600 = 37.5 h, 因此我们没有进行 RESCAL 的网格搜索实验, 也不会进行 RESCAL 的药物重定位实验.

### DistMult

训练脚本: [06_Train_DistMult.ipynb](06_Train_DistMult.ipynb)

DistMult 模型的网格搜索验证集结果, 加粗的是最优结果, MR 越低越好, MRR 和 Hits@k 越高越好.

|参数编号|[0]MRR|[0]MR|[0]HITS@1|[0]HITS@3|[0]HITS@10|[1]MRR|[1]MR|[1]HITS@1|[1]HITS@3|[1]HITS@10|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|1|0.27953768869172535|144.22441371139075|0.19776175300975105|0.3031915618020374|0.43341096039657895|0.27987822388440436|141.42094350286334|0.19814513438242645|0.30309416643401405|0.4334011998066146|
|2|0.42850420681476986|**`77.03553456764062`**|0.3321768795494937|0.46704276949685747|0.611806042612882|0.4273559031623114|78.36405390314322|0.3306742659475949|0.466147110094242|0.6114867625428991|
|3|0.45503971916323466|88.02195347823718|0.3623481505692651|0.49167551887563327|0.6325311870131285|0.45545291082901107|86.00564494712543|0.3630947111816257|0.49154960267471076|0.6321659845972613|
|4|0.21115184783331126|257.94436727134064|0.14700795336928693|0.22849934629841478|0.3246445497630332|0.21150550746475802|253.28818170056584|0.14707164112027346|0.2295396201747278|0.32500663911151667|
|5|0.3887170930490174|95.09525933390985|0.2937074841512492|0.4247669501624029|0.5707286680239961|0.3884288981310466|94.89923121969821|0.2935698915944871|0.4245791796045105|0.570150351364602|
|6|0.4421876367310942|94.19057444026802|0.34832080405294985|0.47969779920466304|0.6211867407528463|0.441997598957335|92.46218089706313|0.3484444051015614|0.47903402629769093|0.6208999230543999|
|7|0.1293204492557603|371.36844004712066|0.08003023349244504|0.1396051941684768|0.21442287395221202|0.1292708182304253|375.4471795500354|0.08008184888598355|0.1395891213161192|0.21357316010241326|
|8|0.3222050036607892|115.43503159557662|0.23162485700277824|0.3531554720270197|0.4937898349403497|0.3211422850107671|115.53231715205949|0.23070061352199758|0.35091279271672443|0.49294211375692|
|9|0.42433107201796333|96.64075597349803|0.3310737656359588|0.46145910647773003|0.6027462088970904|0.42388170415212406|98.12352236204173|0.33019079915018795|0.46102644767663564|0.6025153892248188|
|10|0.28283639816706024|117.26207126660628|0.1986422165780317|0.30610389698822665|0.44374799975486356|0.2831915304432085|118.44005692651305|0.19956624176063628|0.3056837990957128|0.44326414991556357|
|11|0.46720313530023155|77.76997875469849|0.37509533148117885|0.5046201721414174|0.6419690036498339|0.46727195280358425|**`78.06577146475823`**|0.3755558127974833|0.5039698482196967|0.6416990678006496|
|12|**`0.48439492118073163`**|105.27600166149153|**`0.40132170289262953`**|**`0.5158250258756878`**|**`0.6421630713079479`**|**`0.48397887333135575`**|104.80246089733551|**`0.40090019542820565`**|**`0.5151031275322252`**|**`0.642505975200365`**|
|13|0.31773067910122527|117.0837418968241|0.22975567903252164|0.3454268126600207|0.4856526120825843|0.3190512146807909|115.66930755769218|0.23084360977004842|0.34666376134607135|0.4870111741353834|
|14|0.4672355973698691|85.05888721681636|0.37867449287402033|0.5021279203578992|0.6359519804980355|0.46757057693778614|87.67238315084164|0.3790822302119083|0.5022641226779975|0.6359154545949774|
|15|0.4799116844790812|104.82799594163029|0.3963958136146047|0.510666839170077|0.6406572379934222|0.4796667773895746|105.90874734433731|0.3962214686495615|0.5108984311161955|0.6391703437380836|
|16|0.2960559938766072|120.87413606433469|0.2134014721804204|0.32025712087268565|0.4523822493990753|0.29567337374799535|121.14874434820504|0.2135595413193877|0.3192072506400828|0.4514183962521109|
|17|0.4520698517084259|96.14584595899413|0.3637824550412987|0.4851351995478595|0.6227112088630437|0.4533569558370097|95.54875864792722|0.36535449692215505|0.4866331644604238|0.621860870512611|
|18|0.47699706413815457|110.01799381707251|0.39202347878193605|0.5097782862123441|0.6398717110638993|0.4772150236136709|108.74322299924417|0.39252470089951447|0.5090360010077831|0.6399014006822964|

DistMult 模型最佳参数是第 12 号: 

- batch_size: **4096**

- neg_sample_size: **256**

- hidden_dim: 200, **400**

- gamma: **50**, 125, 200

- lr: 0.01, 0.05, **0.1**

对应的测试集结果:

- Test average MRR : 0.4837632646888461

- Test average MR : 105.5472364272728

- Test average HITS@1 : 0.4006771893746978

- Test average HITS@3 : 0.51485118176185

- Test average HITS@10 : 0.6430064620685428

### ComplEx

训练脚本: [07_Train_ComplEx.ipynb](07_Train_ComplEx.ipynb)

ComplEx 模型的网格搜索验证集结果, 加粗的是最优结果, MR 越低越好, MRR 和 Hits@k 越高越好.

|参数编号|[0]MRR|[0]MR|[0]HITS@1|[0]HITS@3|[0]HITS@10|[1]MRR|[1]MR|[1]HITS@1|[1]HITS@3|[1]HITS@10|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|1|0.3469807991169364|136.86552132701422|0.2557607452198072|0.3815642534183145|0.5230531949664978|0.34743771338067886|134.11737608694173|0.25603137746242943|0.3816229393219254|0.5244693817795543|
|2|0.5318915831671349|**`77.8826741842349`**|0.4305373971781882|0.5885459225363622|0.7201408182164841|0.5318304797882802|**`76.20201624709752`**|0.43049360942958115|0.5882184710296411|0.7199690855730404|
|3|0.5811299030278562|85.80649543433408|0.4837494978107955|0.6413347678353772|0.7561845877281982|0.5798372634952892|87.80446151331917|0.48291523669444897|0.6389864901672386|0.7547699787546985|
|4|0.22055428159633797|232.88462847959906|0.1598947268072125|0.23535299885602223|0.3258055510159612|0.22079080941872903|229.41645273974|0.1599583268077109|0.23516754393729955|0.32578630913065093|
|5|0.428429941073757|107.51746256562507|0.32756014354099566|0.47338226982711074|0.6247744404420627|0.4278626397349271|109.62697812823446|0.3268882442664923|0.4734059214468595|0.6234372446478182|
|6|0.5401820964436721|93.97378402119068|0.43930149737499746|0.5972238299842704|0.7280143268621857|0.541082498409603|94.12529961322656|0.44004671242577764|0.598814484937626|0.728281445770006|
|7|0.24832751622454108|219.70621761305216|0.180754066881388|0.26791368474093846|0.37180386362243545|0.24727841150416585|223.68315220351909|0.17945470392765703|0.2674354469684589|0.3707134880427085|
|8|0.3213580182020486|135.4179610096897|0.23454448885650667|0.35075277310581043|0.485356503265081|0.3207755248926456|138.59269965135914|0.23358936645421366|0.35099689491747016|0.4851657405894209|
|9|0.49600111565653976|96.99782441422609|0.3914760617471418|0.5520199922373465|0.6918124433973185|0.49612402287679197|97.00388475785803|0.3909986653592635|0.5527795936155145|0.6922018848395708|
|10|0.3457875705998156|138.9755714742913|0.25656931572890634|0.3794575675657272|0.5174693749702091|0.34551373128746576|142.5985046576238|0.25680598681701805|0.38010023424306805|0.5153007027292041|
|11|0.5968819649446984|85.82162458462712|0.5054441085144632|0.652652938933377|0.7615793702674729|0.5982212907615312|83.6159597431515|0.5072247151991393|0.653577970406586|0.7624491852618533|
|12|**`0.6225582943375586`**|113.25173299014|**`0.5392050716347987`**|**`0.6751477637958272`**|**`0.7693318625047666`**|**`0.6232425193927783`**|112.21650312889409|**`0.5398244550821547`**|**`0.675854743049361`**|**`0.7700960798599998`**|
|13|0.3823081701644151|133.4291074249605|0.2886773437925587|0.42136514681048104|0.5626838535708449|0.38265855488797723|131.73779595116338|0.28911117617818693|0.4207528411992619|0.5635073574974294|
|14|0.5897058289966878|91.26739118592363|0.5000783080023969|0.6425988723647655|0.7535681211526938|0.5906692746677442|89.94371735770171|0.5007898840368522|0.6441708600883853|0.7541451888571876|
|15|0.6116322570059144|113.25871261644059|0.5251232499863813|0.665675900201558|0.7664106335457863|0.6126477150112932|110.57705454966396|0.5267879638015212|0.6655385851542657|0.7667833334468224|
|16|0.332514993750518|140.62108377537334|0.2472983923136112|0.3630981158541983|0.4941984379362237|0.330369024290014|142.8575679577273|0.245471754644005|0.3604891866862777|0.49164828130958216|
|17|0.5469951827858731|107.08743939641553|0.4516022498229558|0.6009151822193168|0.7234297543171542|0.5477246486108881|105.14996220813444|0.4522324438058792|0.6013502931423085|0.7248207439890506|
|18|0.6015926580140895|115.81775685024786|0.5147661654954513|0.6540761017595468|0.7585423816527755|0.6017575744962644|113.84758983228583|0.514163437902177|0.6548955786921972|0.7597560892568962|

ComplEx 模型最佳参数是第 12 号: 

- batch_size: **4096**

- neg_sample_size: **256**

- hidden_dim: 200, **400**

- gamma: **50**, 125, 200

- lr: 0.01, 0.05, **0.1**

对应的测试集结果:

- Test average MRR : 0.6205933890482063

- Test average MR : 112.74029838550426

- Test average HITS@1 : 0.5368538782625275

- Test average HITS@3 : 0.673296131611023

- Test average HITS@10 : 0.7684822650605692

### RotatE

训练脚本: [08_Train_RotatE.ipynb](08_Train_RotatE.ipynb)

RotatE 模型的网格搜索验证集结果, 加粗的是最优结果, MR 越低越好, MRR 和 Hits@k 越高越好.

|参数编号|[0]MRR|[0]MR|[0]HITS@1|[0]HITS@3|[0]HITS@10|[1]MRR|[1]MR|[1]HITS@1|[1]HITS@3|[1]HITS@10|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|1|0.5476224588249963|70.8774692387833|0.4508365280510973|0.6048502965469811|0.7183654847913277|0.545990260653221|73.28551097673912|0.44880358991120556|0.6036355341286702|0.7168961431606472|
|2|0.5219364930603517|71.40283404944947|0.4167489462538388|0.5841601013230557|0.7088596389685204|0.5193797369810023|73.27038731818925|0.41355477474532876|0.5824753500027238|0.7072097837337256|
|3|0.4918308723175946|75.99342898193481|0.3841560157159686|0.5536201883464867|0.686804170042967|0.4892873800041604|77.6950958762325|0.3809990739227543|0.5513700495723702|0.6845957945198017|
|4|0.5985003701989992|67.07690474407076|0.5028088548724269|0.6593659137800718|0.7615401376849589|0.5969835263712435|69.65118891975813|0.5013380454322601|0.6580153347496868|0.7596761453396524|
|5|0.6017782716234142|**`60.91930245068332`**|0.502798640854709|0.6661786635979218|0.7695547369209503|0.6001885700442473|63.01837173830147|0.5011814294274664|0.6649847469630114|0.7679495560276733|
|6|0.5774183128251846|62.680663370921174|0.47259900855259573|0.6458503568121152|0.757517568230103|0.5790303370345516|61.33354215325112|0.47446495570520986|0.6468435280579067|0.7583635781746869|
|7|0.5694204668777523|79.21241556354524|0.4661743476602931|0.635278776488533|0.7486755733507654|0.5713861354586558|76.52468728082421|0.46843868525163934|0.6370074289955535|0.7502945041775333|
|8|**`0.6159215820161785`**|62.89526546232049|**`0.5171152890226547`**|**`0.6825959947431856`**|**`0.7816208965183818`**|**`0.6135984576630072`**|64.93042504221823|**`0.5142861033938008`**|**`0.6807450836193277`**|**`0.7798319442174647`**|
|9|0.5976592798000654|61.72555087977339|0.4928671623903688|0.668832053167729|0.7746874489295636|0.5992451523765985|**`59.85334032426102`**|0.49443336034373575|0.6704719557120192|0.775645696153401|

RotatE 模型最佳参数是第 8 号: 

- batch_size: **4096**

- neg_sample_size: **256**

- hidden_dim: **200**

- gamma: 6, 12, **18**

- lr: 0.01, **0.05**, 0.1

对应的测试集结果:

- Test average MRR : 0.6142171144502637

- Test average MR : 63.51198955446455

- Test average HITS@1 : 0.5154776415152155

- Test average HITS@3 : 0.6808017322974049

- Test average HITS@10 : 0.7799526069577889

## 最优模型

各种模型最佳参数

|模型|编号|batch_size|neg_sample_size|hidden_dim|gamma|lr|
|:-:|:-:|:-:|:-:|:-:|:-:|:-:|
|TransE_l1|17|4096|256|400|18|0.05|
|TransE_l2|15|4096|256|400|12|0.1|
|DistMult|12|4096|256|400|50|0.1|
|ComplEx|12|4096|256|400|50|0.1|
|RotatE|8|4096|256|200|18|0.05|

对应的测试集结果, 加粗的是最优结果, 斜体是次优结果, MR 越低越好, MRR 和 Hits@k 越高越好.:

|模型|MRR|MR|HITS@1|HITS@3|HITS@10|
|:-:|:-:|:-:|:-:|:-:|:-:|
|TransE_l1|0.5299729313494324|*`62.644429615203904`*|0.41152788086369735|0.6055363380703678|0.7400889981410488|
|TransE_l2|0.43722459698865124|**`60.83355236726884`**|0.3020931926976583|0.5153057055502972|0.6925784947261622|
|DistMult|0.4837632646888461|105.5472364272728|0.4006771893746978|0.51485118176185|0.6430064620685428|
|ComplEx|**`0.6205933890482063`**|112.74029838550426|**`0.5368538782625275`**|*`0.673296131611023`*|*`0.7684822650605692`*|
|RotatE|*`0.6142171144502637`*|63.51198955446455|*`0.5154776415152155`*|**`0.6808017322974049`**|**`0.7799526069577889`**|

---

对应的测试集结果, 加粗的是最优结果, 斜体是次优结果, MR 越低越好, MRR 和 Hits@k 越高越好. 其中 MRR 和 Hits@k 保留小数点后三位 (四舍五入), MR 保留小数点后两位 (四舍五入):

|模型|MRR|MR|HITS@1|HITS@3|HITS@10|
|:-:|:-:|:-:|:-:|:-:|:-:|
|TransE_l1|0.530|*`62.64`*|0.412|0.606|0.740|
|TransE_l2|0.437|**`60.83`**|0.302|0.515|0.693|
|DistMult|0.484|105.55|0.401|0.515|0.643|
|ComplEx|**`0.621`**|112.74|**`0.537`**|*`0.673`*|*`0.768`*|
|RotatE|*`0.614`*|63.51|*`0.515`*|**`0.681`**|**`0.780`**|

考虑到上面的结果，我们排除了 DistMult 模型.

## 训练最佳模型

这一次我们没有划分数据集, 直接用全部的三元组训练的模型.

为了更充分的训练 RotatE, 我们将 max_step 从 **60000** 改变为 **100000**, 使得它和其它种类的模型训练的 max_step 一样.

训练脚本:

- [09_Train_final_model_TransE_l1.ipynb](09_Train_final_model_TransE_l1.ipynb): TransE_l1.

- [10_Train_final_model_TransE_l2.ipynb](10_Train_final_model_TransE_l2.ipynb): TransE_l2.

- [11_Train_final_model_ComplEx.ipynb](11_Train_final_model_ComplEx.ipynb): ComplEx.

- [12_Train_final_model_RotatE.ipynb](12_Train_final_model_RotatE.ipynb): RotatE.

## 获得实体和关系嵌入
  
实体和关系嵌入将保存在 ./ckpts, 将有以下输出文件:

- **Trained Embeddings**: The saved model. 
   
   - `<dataset_name>_<model>_entity.npy` for entity embedding: .\/ckpts\/\<model\_name>\_\<dataset\_name>\_\<run_id>\/<dataset\_name>\_\<model>\_entity.npy , 如 ./ckpts/TransE_l2_DRKG_0/DRKG_TransE_l2_entity.npy .
   
   - `<dataset_name>_<model>_relation.npy` for relation embedding: .\/ckpts\/\<model\_name>\_\<dataset\_name>\_\<run_id>\/<dataset\_name>\_\<model>\_relation.npy , 如 ./ckpts/TransE_l2_DRKG_0/DRKG_TransE_l2_relation.npy .

- **config.json**: The config file records all the details of the training configurations as well as the locations of ID mapping files generated by **dgl_train** : .\/ckpts\/\<model\_name>\_\<dataset\_name>\_\<run_id>\/config.json.

- **ID mapping Files** (Optional): The the input data is in format of Raw User Defined Knowledge Graph, that is all triplets use the Raw ID space. The training script will do the ID convertion and generate two ID mapping files: `entities.tsv` and `relations.tsv`.

   - `entities.tsv`: The entity id mapping, formated in `<entity_id>\t<entity_name>` pair: ./\<data_path>/entities.tsv, 如 ./dataset/entities.tsv .
   
   - `relations.tsv`: The relation id mapping, formated in `<relation_id>\t<relation_name>` pair: ./\<data_path>/relations.tsv, 如 ./dataset/relations.tsv .

```python
node_emb = np.load('./ckpts/TransE_l2_DRKG_0/DRKG_TransE_l2_entity.npy')
relation_emb = np.load('./ckpts/TransE_l2_DRKG_0/DRKG_TransE_l2_relation.npy')

print(node_emb.shape)
print(relation_emb.shape)
```